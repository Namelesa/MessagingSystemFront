<app-chat-layout
  [selectedChat]="selectedChat"
  [selectedChatImage]="selectedChatImage"
  [groupId]="selectedGroupId"
  (headerClick)="onHeaderClick()"
  (fileDrop)="onFileUpload({ files: $event })"
  (dragStateChange)="isDragOver = $event"
>
  <app-group-chat-list
    chat-sidebar
    [accessToken]="accessToken || ''"
    [user$]="user$"
    (userSearchQueryChange)="onUserSearchQueryChange($event)"
    (userSearchFocus)="onUserSearchFocus()"
    (userSearchClear)="onUserSearchClear()"
    (selectChat)="onChatSelected($event.nickname, $event.image, $event.groupId)"
  ></app-group-chat-list>

  <ng-container chat-content>
    <ng-container *ngIf="selectedChat; else noChatSelected">
      <div class="flex flex-col h-full">
        <div class="flex-1 overflow-y-auto">
          <widgets-group-messages 
            #messagesComponent
            *ngIf="selectedGroupId"
            [groupId]="selectedGroupId"
            [members]="groupMembers"
             [currentUserNickName]="currentUserNickName"
             [messages$]="groupMessages.messages$"
             [userInfoChanged$]="groupMessages.userInfoChanged$"
             [loadHistory]="groupMessages.loadChatHistory.bind(groupMessages)"
            (editMessage)="onEditMessage($event)"
            (deleteMessage)="onDeleteMessage($event)"
            (replyToMessage)="onReplyToMessage($event)">
          </widgets-group-messages>
        </div>
        <shared-send-message-area
          [editingMessage]="editingMessage"
          [replyingToMessage]="replyingToMessage"
          (send)="sendMessage($event)"
          (editComplete)="onEditComplete($event)"
          (editCancel)="onEditCancel()"
          (replyCancel)="onCancelReply()"
          (fileUpload)="onFileUpload($event)"
        ></shared-send-message-area>
      </div>     
    </ng-container>
    <ng-template #noChatSelected></ng-template>
  </ng-container>
</app-chat-layout>

<app-group-info-modal #groupInfoModal
  [groupId]="selectedGroupId"
  [open]="groupInfoModalOpen"
  [userSuggestions]="userSuggestion"
  (userSearchQueryChange)="onModalUserSearchQueryChange($event)"
  (close)="closeGroupInfoModal()"
  (groupUpdated)="onGroupUpdated()"
  (openChatWithUser)="onOpenChatWithUser($event)"
  (addMembersRequested)="onAddMembersRequested($event)"
  (removeMemberRequested)="onRemoveMemberRequested($event)"
  (deleteGroupRequested)="onDeleteGroupRequested()"
/>

<div 
  *ngIf="isDeleteModalOpen" 
  class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50"
  (click)="closeDeleteModal()"
>
  <div 
    class="bg-theme-primary text-theme-primary rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-theme transition-colors duration-300"
    (click)="$event.stopPropagation()"
  >
    <div class="flex items-center mb-4">
      <img 
        [src]="selectedChatImage || 'assets/default-avatar.png'" 
        [alt]="selectedChat"
        class="w-12 h-12 rounded-full object-cover border border-theme mr-3"
      >
      <h3 class="text-lg font-semibold text-theme-primary">
        {{ 'otoPage.deleteMessage' | translate }}
      </h3>
    </div>

    <p class="text-theme-secondary mb-4">
      {{ 'otoPage.deleteMessageSubtitle' | translate }}
    </p>

    <label class="flex items-center mb-6 cursor-pointer">
      <input 
        type="checkbox" 
        [(ngModel)]="deleteForBoth"
        class="w-4 h-4 rounded border border-theme bg-theme-secondary text-theme-accent focus:ring-2 focus:ring-theme-accent transition-colors"
      >
      <span class="ml-3 text-sm text-theme-secondary">
        {{ 'groupList.deleteForAll' | translate }}
      </span>
    </label>

    <div class="flex justify-end space-x-4">
      <button
        (click)="closeDeleteModal()"
        class="px-4 py-2 text-sm font-medium text-theme-accent hover:opacity-80 transition-colors"
      >
        {{ 'otoPage.cancel' | translate }}
      </button>
      <button
        (click)="onConfirmDelete()"
        class="px-4 py-2 text-sm font-medium text-red-500 hover:opacity-80 transition-colors"
      >
        {{ 'otoPage.delete' | translate }}
      </button>
    </div>
  </div>
</div>

<file-drop-overlay 
  *ngIf="selectedChat && isDragOver"
  [isVisible]="isDragOver">
</file-drop-overlay>