<div class="w-80 h-16 overflow-visible">
  <div class="flex items-center gap-3 py-2 px-2 h-full relative">
    <audio #audioElement [src]="src" preload="metadata"></audio>

    <button 
      (click)="togglePlay()"
      class="flex-shrink-0 w-8 h-8 bg-white hover:bg-gray-50 disabled:bg-gray-200 disabled:cursor-not-allowed text-blue-600 hover:text-blue-700 disabled:text-gray-400 rounded-full flex items-center justify-center transition-all duration-200 border border-white shadow-sm"
      [disabled]="isLoading">
      <svg *ngIf="!isPlaying" class="w-3 h-3 ml-0.5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M8 5v14l11-7z"/>
      </svg>
      <svg *ngIf="isPlaying" class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
      </svg>
    </button>

    <div class="flex-1 min-w-0 w-44 max-w-44">
      <div class="h-4 overflow-hidden relative w-full mb-1">
        <div 
          class="text-xs font-medium text-white drop-shadow-sm whitespace-nowrap inline-block transition-transform duration-300"
          #fileNameElement
          [class]="shouldScroll ? 'animate-scroll' : ''"
          [style.animation-duration]="shouldScroll ? '8s' : 'none'">
          {{ fileName || 'Audio File' }}
        </div>
      </div>

      <div class="flex items-center gap-2">
        <span class="text-xs text-white/80 font-mono drop-shadow-sm min-w-7 text-center">
          {{ formatTime(currentTime) }}
        </span>

        <div class="flex-1">
          <div class="relative h-1 bg-white/30 rounded-full overflow-hidden">
            <div 
              class="absolute top-0 left-0 h-full bg-white transition-all duration-150 ease-out rounded-full"
              [style.width.%]="duration > 0 ? (currentTime / duration) * 100 : 0">
            </div>
            <input 
              type="range" 
              min="0" 
              max="100" 
              [value]="duration > 0 ? (currentTime / duration) * 100 : 0"
              (input)="onSeek($event)"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed"
              [disabled]="isLoading">
          </div>
        </div>

        <span class="text-xs text-white/80 font-mono drop-shadow-sm min-w-7 text-center">
          {{ formatTime(duration) }}
        </span>
      </div>
    </div>

    <div class="flex-shrink-0 relative" 
         #volumeContainer
         (mouseenter)="showVolumeSlider = true" 
         (mouseleave)="onVolumeContainerLeave($event)">

      <button 
        (click)="toggleMute()"
        class="w-7 h-7 text-white/90 hover:text-white transition-all duration-200 
               flex items-center justify-center rounded-full 
               hover:bg-white/10 border border-white/30 hover:border-white/50 backdrop-blur-sm">
        <svg *ngIf="!isMuted && volume > 0.5" class="w-3.5 h-3.5 drop-shadow-sm" fill="currentColor" viewBox="0 0 24 24">
          <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
        </svg>
        <svg *ngIf="!isMuted && volume <= 0.5 && volume > 0" class="w-3.5 h-3.5 drop-shadow-sm" fill="currentColor" viewBox="0 0 24 24">
          <path d="M5 9v6h4l5 5V4L9 9H5z"/>
        </svg>
        <svg *ngIf="isMuted || volume === 0" class="w-3.5 h-3.5 drop-shadow-sm" fill="currentColor" viewBox="0 0 24 24">
          <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63z"/>
        </svg>
      </button>

      <div 
        data-volume-slider
        class="absolute bottom-8 left-1/2 -translate-x-1/2
               transition duration-200 ease-out
               h-28 w-10 flex items-center justify-center z-20 px-2"
        [class.opacity-0]="!showVolumeSlider"
        [class.opacity-100]="showVolumeSlider"
        [class.pointer-events-none]="!showVolumeSlider"
        [class.pointer-events-auto]="showVolumeSlider">
        
        <div class="relative w-1 h-24 bg-white/40 rounded-full overflow-hidden"
             (click)="onVolumeBarClick($event)"
             (mousedown)="onVolumeBarMouseDown($event)">
          <div 
            class="absolute bottom-0 left-0 w-full bg-white rounded-full transition-all duration-150"
            [style.height.%]="(isMuted ? 0 : volume) * 100">
          </div>
        </div>
      </div>
    </div>

    <div class="flex-shrink-0">
      <button 
        (click)="downloadFile()"
        class="w-7 h-7 text-white/90 hover:text-white transition-all duration-200 flex items-center justify-center rounded-full hover:bg-white/10 border border-white/30 hover:border-white/50 backdrop-blur-sm"
        title="Download audio">
        <svg class="w-3.5 h-3.5 drop-shadow-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3"/>
        </svg>
      </button>
    </div>

    <div *ngIf="isLoading" class="absolute left-2 flex items-center">
      <div class="w-3 h-3 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"></div>
    </div>
  </div>
</div>